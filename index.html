<!DOCTYPE html>
<html lang="en">
    <!-- photos automatically taken by our building's entrance camera when our doorbell is rang. pulling from are.na/ryan-yan/at-the-door -->
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>At the Door</title>
        <link rel="icon" type="image/x-icon" href="favicon.ico">
        <style>
            body{
                margin:0;
                padding:0;
                width:100vw;
                height:100vh;
                display:flex;
                flex-direction:column;
                justify-content:center;
                align-items:center;
                font-family:arial;
            }

            img{
                width:50vw;
                max-width:500px;
                height:auto;
            }

            #position{
                font-size:10px;
            }
        </style>
    </head>
    <body>
        <div id="container">
        </div>
        <p id="position"></p>
        <script>
            async function loadBlocks() {
                try {
                    const channelRes = await fetch("https://api.are.na/v2/channels/at-the-door?per=100");
                    const channelData = await channelRes.json();
                    
                    const totalPages = Math.ceil(channelData.length / 100);
                    
                    const fetchPromises = [];
                    
                    for (let page = 1; page <= totalPages; page++) {
                        fetchPromises.push(
                            fetch(`https://api.are.na/v2/channels/at-the-door?per=100&page=${page}`)
                            .then(res => res.json())
                        );
                    }
                    
                    const allPages = await Promise.all(fetchPromises);
                    const allBlocks = allPages.flatMap(pageData => pageData.contents);
                    
                    const container = document.getElementById("container");
                    const img = document.createElement("img");
                    container.appendChild(img);
                    
                    let hoverZone = window.innerWidth / allBlocks.length;
                    let currentIndex;
                    
                    window.addEventListener('resize', () => {
                        hoverZone = window.innerWidth / allBlocks.length;
                    });
                    
                    document.addEventListener('mousemove', function(event) {
                        const x = event.clientX;
                        currentIndex = Math.floor(x / hoverZone);
                        
                        img.src = allBlocks[currentIndex].image.display.url;
                        console.log(currentIndex);
                    });
                    
                    document.addEventListener('click', function() {
                        window.open(`https://are.na/block/${allBlocks[currentIndex].id}`, "_blank");
                    });
                } catch (error) {
                    console.error('error fetching blocks:', error);
                }
            }

            loadBlocks();
        </script>
    </body>
</html>